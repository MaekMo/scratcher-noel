<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MA EK MO ‚Äî Administration</title>

  <style>
    body {
      margin:0;
      padding:0;
      font-family:'Poppins', sans-serif;
      background:url('Prix2.PNG') center/cover no-repeat fixed;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      color:#000;
    }

    .container {
      background:rgba(255,255,255,0.8);
      border-radius:20px;
      padding:25px;
      width:90%;
      max-width:800px;
      margin-top:40px;
      backdrop-filter:blur(4px);
      box-shadow:0 0 15px rgba(255,215,0,0.5);
    }

    h1 {
      text-align:center;
      color:#000;
      margin-bottom:20px;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
      background:white;
      border-radius:12px;
      overflow:hidden;
    }

    th, td {
      padding:10px;
      text-align:center;
      border-bottom:1px solid #eee;
    }

    th {
      background:gold;
      color:black;
    }

    tr:nth-child(even) {
      background:#f9f9f9;
    }

    button {
      background:gold;
      color:black;
      border:none;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:bold;
    }

    #counter {
      text-align:center;
      font-size:1.2em;
      font-weight:600;
      color:#333;
      margin-top:10px;
    }

    .actions {
      text-align:center;
      margin-top:20px;
    }

    .actions button {
      margin:0 10px;
    }

    @media(max-width:600px){
      table{ font-size:0.9em; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>MA EK MO ‚Äî Administration</h1>
    <p id="counter">Chargement du compteur...</p>

    <table id="players-table">
      <thead>
        <tr>
          <th>Joueur n¬∞</th>
          <th>R√©sultat</th>
          <th>Date</th>
          <th>Statut paiement</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="actions">
      <button id="reset-btn">üîÑ R√©initialiser compl√®tement</button>
    </div>
  </div>

  <!-- üî• Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getFirestore, collection, getDocs, updateDoc, doc, deleteDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZcpcC_7l6wYN4SJUGa9dBbEa_ekV1n20",
      authDomain: "ma-ek-mo-grattage.firebaseapp.com",
      projectId: "ma-ek-mo-grattage",
      storageBucket: "ma-ek-mo-grattage.firebasestorage.app",
      messagingSenderId: "478221366203",
      appId: "1:478221366203:web:ffb64fe9cbb7dc0aa20a9e",
      measurementId: "G-BZSKRGV3PS"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tableBody = document.querySelector("#players-table tbody");
    const counterEl = document.getElementById("counter");
    const resetBtn = document.getElementById("reset-btn");

    async function loadPlayers() {
      const snapshot = await getDocs(collection(db, "joueurs"));
      tableBody.innerHTML = "";
      let winners = 0;

      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const tr = document.createElement("tr");

        if (data.resultat.includes("gagn√©")) winners++;

        tr.innerHTML = `
          <td>${data.numero || "-"}</td>
          <td>${data.resultat || "-"}</td>
          <td>${new Date(data.date).toLocaleString("fr-FR")}</td>
          <td>${data.paye ? "‚úÖ Valid√©" : "‚ùå En attente"}</td>
          <td>
            <button onclick="validatePayment('${docSnap.id}')">Valider</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });

      const winnersLeft = 5 - winners;
      counterEl.textContent = `üéâ Gagnants restants : ${winnersLeft >= 0 ? winnersLeft : 0}`;
    }

    window.validatePayment = async (id) => {
      const pass = prompt("Mot de passe administrateur :");
      if (pass !== "maekmo2025") {
        alert("‚ùå Mot de passe incorrect !");
        return;
      }
      const docRef = doc(db, "joueurs", id);
      await updateDoc(docRef, { paye: true });
      alert("‚úÖ Paiement valid√© !");
      loadPlayers();
    };

    resetBtn.addEventListener("click", async () => {
      const pass = prompt("Entrez le mot de passe admin pour r√©initialiser :");
      if (pass !== "maekmo2025") {
        alert("‚ùå Mot de passe incorrect !");
        return;
      }

      if (!confirm("‚ö†Ô∏è Confirmer la suppression de tous les joueurs ?")) return;

      const snapshot = await getDocs(collection(db, "joueurs"));
      for (const docSnap of snapshot.docs) {
        await deleteDoc(doc(db, "joueurs", docSnap.id));
      }

      alert("‚úÖ Jeu r√©initialis√© !");
      loadPlayers();
    });

    loadPlayers();
  </script>
</body>
</html>
